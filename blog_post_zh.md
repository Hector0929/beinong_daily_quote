# 北農每日行情查詢系統開發紀實：從網頁爬蟲到穩定 API 的進化之路

在這兩天的開發衝刺中，我們成功將一個不穩定的網頁爬蟲工具，轉型為一個高效、使用者友善的現代化網頁應用程式。這篇文章將分享我們如何克服技術挑戰、優化使用者體驗，以及 AI 如何協助我們達成目標。

## 1. 挑戰：克服不穩定的資料來源

專案初期的最大痛點在於資料獲取。原本我們使用 Puppeteer 模擬瀏覽器去爬取「台北農產運銷公司」的網頁。然而，這種方式存在幾個致命缺點：
*   **不穩定**：網頁結構的微小變動就會導致爬蟲失敗。
*   **速度慢**：需要啟動無頭瀏覽器 (Headless Browser)，消耗大量資源且等待時間長。
*   **維護成本高**：需要不斷修復因網站改版而失效的程式碼。

### 解決方案：轉向政府開放資料 (Open Data)
在 AI 的協助下，我們評估並決定切換到 **農業部開放資料平台 (MOA Open Data API)**。
*   **穩定性**：API 提供標準化的 JSON 格式，不受網頁介面改版影響。
*   **效率**：直接的 HTTP 請求比模擬瀏覽器快上數倍。
*   **準確性**：官方維護的資料源，確保了行情的正確性。

## 2. 資料管理的智慧化

解決了資料來源後，我們面臨的是如何管理這些資料。

### 單一備份策略 (Single Source of Truth)
原本的設計會為每一天的查詢建立一個新的 JSON 檔案，這會導致伺服器上堆積成千上萬個小檔案。我們改採「單一備份」策略，只保留最新的 `latest_Vegetable.json` 和 `latest_Fruit.json`。這不僅讓專案結構更乾淨，也確保了我們永遠有一份最新的備份資料可用於離線或 API 故障時的備援。

### 智慧預載 (Smart Preloading)
為了讓使用者一打開網頁就能立即工作，我們實作了「智慧預載」功能。系統啟動時會自動在背景抓取當日的蔬菜與水果行情。這意味著使用者不需要先點擊「查詢資料」，就能直接在輸入框中享受到完整的自動完成 (Autocomplete) 功能。

## 3. AI 協助的使用者體驗 (UX) 優化

AI 不僅僅是寫程式，更在設計決策上提供了關鍵建議：

*   **混合搜尋 (Combined Autocomplete)**：原本使用者需要先切換「蔬菜」或「水果」類別才能搜尋。我們將兩者的資料庫合併，讓使用者在同一個輸入框就能找到所有產品，大幅減少操作步驟。
*   **總重智慧計算**：針對農產品交易中常見的單位混亂問題（公斤、公克、台斤），我們實作了自動換算邏輯。系統會自動識別單位，將所有品項統一換算為「公斤」並計算總重，並精確到小數點後三位，解決了人工計算容易出錯的問題。
*   **防呆與保存**：我們修改了表格邏輯，確保在重新查詢行情時，使用者已經輸入的訂單內容不會被清空，避免資料遺失。

## 4. 技術總結

這次的重構充分利用了現代 Web 技術的優勢：
*   **Frontend**: Next.js + React 提供流暢的互動體驗。
*   **Backend**: Node.js API Routes 處理資料抓取與檔案 I/O。
*   **Styling**: Tailwind CSS 打造簡潔、列印友善 (Print-friendly) 的介面。

透過這次的迭代，我們證明了只要選對技術方案（從 Scraping 轉向 API），並配合細緻的 UX 考量，就能將一個簡單的工具昇華為專業的生產力軟體。
